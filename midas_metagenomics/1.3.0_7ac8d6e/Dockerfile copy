FROM ubuntu:18.04
LABEL author="Miguel Machado <mpmachado@medicina.ulisboa.pt>" version="1.3.0_7ac8d6e-01"

WORKDIR /NGStools/

# General Dependencies
RUN apt update && \
    apt install -y git python3-dev python3-pip wget

# Python3
RUN pip3 install -U numpy biopython pysam pandas

# Bowtie2
RUN apt install -y zip
RUN wget -nv https://sourceforge.net/projects/bowtie-bio/files/bowtie2/2.4.4/bowtie2-2.4.4-linux-x86_64.zip && \
    unzip bowtie2-2.4.4-linux-x86_64.zip && \
    rm bowtie2-2.4.4-linux-x86_64.zip

# samtools
RUN apt install -y zlib1g-dev
RUN apt install -y bzip2 libncurses5-dev libbz2-dev liblzma-dev
RUN wget -nv https://github.com/samtools/samtools/releases/download/1.12/samtools-1.12.tar.bz2 && \
    tar xf samtools-1.12.tar.bz2 && \
    cd samtools-1.12 && \
    ./configure --prefix=/NGStools/samtools-1.12_installation && \
    make && \
    make install && \
    cd ../ && \
    rm -r samtools-1.12.tar.bz2 samtools-1.12/

# hs-blastn
RUN git clone https://github.com/chenying2016/queries.git && \
    cd queries && \
    cd hs-blastn-src && \
    make && \
    cd ..

# MIDAS
RUN git clone https://github.com/snayfach/MIDAS

ENV PYTHONPATH="/NGStools/MIDAS:${PYTHONPATH}" PATH="/NGStools/MIDAS/scripts:/NGStools/queries/Linux-amd64/bin:/NGStools/bowtie2-2.4.4-linux-x86_64:/NGStools/samtools-1.12_installation/bin:${PATH}"

# Clean
RUN apt-get remove -y git python-pip wget zip && apt-get autoclean -y

RUN ln -s /usr/bin/python3 /NGStools/bowtie2-2.4.4-linux-x86_64/python
WORKDIR /data/
